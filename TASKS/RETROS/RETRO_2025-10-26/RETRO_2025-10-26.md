# RETRO: 2025-10-26

**Patterns extracted from 10 completed plans (5 systems, 5 iterations/refinements).**

---

## Patterns Found

### 1. External Review Divergence (4+ occurrences)
Codex finds hygiene issues. Gemini approves architecture. Both valuable.
- handbrake_input_ITERATION_2: unused forward declaration vs approval
- VEHICLE_MASS_ITERATION_1: "dead state" vs "infrastructure"
- handbrake_refactor_ITERATION_1: stale docs vs architectural discipline
- angle_arc_primitive_ITERATION_1: approval vs "frame inverted" (false)

### 2. Encapsulation Breakage (3 occurrences)
Parameter unpacking exposes internals. Systems pass multiple params instead of scalar.
- handbrake_refactor: `compute_total_drag(bool active, float rate)` unpacks internals
- Fix applied: `get_drag_contribution()` returns scalar

### 3. Foundation Validation Gaps (3 occurrences)
Primitives lack input validation until audited.
- spring_damper: No `dt > 0` check
- angle_arc: Ad hoc assertions instead of FL_ASSERT macros
- No postcondition assertions on mesh structure

### 4. Single Source Duplication (3 occurrences)
Constants defined in multiple places create drift.
- brake_rate default in two files
- ANGLE_EPSILON instead of FL_EPSILON
- Gravity constant duplicated

### 5. Dead State Interpretation Ambiguous (2 occurrences, significant)
"Justify existence" has two valid readings:
- Codex: Must affect behavior now
- Gemini: Can enable future systems
- Resolved via cross-principle validation

---

## Important Ideas Extracted

1. **Three-layer validation works**: Internal (architecture) + External (hygiene) + Playtest (physics)
2. **Composition pattern successful**: No inheritance violations across all plans
3. **Workflow reliable**: Graybox → Refine → Approve → Close pattern works
4. **Time-independence hard to spot**: Requires multi-frame analysis
5. **Plans are thinking tools**: Divergence from final code acceptable

---

## Actions

### Create Context Files
**PHYSICS_VALIDATION.md** - Capture time-independence review patterns
- How to spot sequential integrator composition issues
- When semi-implicit Euler acceptable (vertical only)
- Multi-frame analysis technique

**REVIEW_PATTERNS.md** - Document divergence handling
- Codex: hygiene, consistency, dead state strict interpretation
- Gemini: architecture, enablement, infrastructure justification
- How to arbitrate divergence

### Workflow Updates
**Simplify iteration template** - Remove duplicate sections
- Delete "Implementation Review" section (duplicates Results)
- Merge "External Review" findings into single section

**Add validation checklist to templates**
- Foundation primitives: Check dt > 0, use FL_ASSERT macros
- Constants: Verify single source
- Encapsulation: Return scalars, not unpacked state

### Backlog Updates
**Add foundation validation audit task**
- Sweep all math_utils.h functions for input validation
- Add FL_PRECONDITION assertions consistently
- Verify all mesh generators have postconditions

**Add single-source constant audit**
- Find all duplicated constants
- Move to single definition points
- Consider constexpr header for game constants

### PRINCIPLES.md Updates
**None.** Principles correctly guided all decisions.

### Defer
**Plan-to-code divergence** - Already accepted as natural evolution
**Dead state interpretation** - Cross-principle validation working
**Documentation drift** - Plans are thinking tools, not contracts

---

## Summary

10 plans completed successfully. Three-layer validation (internal/external/playtest) catches distinct issue classes. Composition pattern applied consistently. Workflow reliable.

Main friction: Foundation validation gaps and constant duplication. Both fixable via context files and targeted audits.

No principle violations. Process works.

---

**Actions: 2 context files, 2 workflow simplifications, 2 backlog items, 0 principle updates.**